"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const dir_1 = require("./dir");
const git_1 = require("./git");
const TMP_DIR = 'tmp';
let activeProjs;
function buildProj(struct, config = {}) {
    config = Object.assign({ tmpDir: TMP_DIR }, config);
    let dirRes = dir_1.buildDirStruct(struct, config);
    let gitRes;
    if (config.git) {
        let gitConfig = Object.assign({ tmpDir: config.tmpDir }, typeof config.git === 'object' ? config.git : {});
        gitRes = git_1.buildGitRepo(dirRes.path, gitConfig);
    }
    let res = {
        path: dirRes.path,
        delete() {
            dirRes.delete();
            if (gitRes) {
                gitRes.delete();
            }
        }
    };
    if (activeProjs) {
        activeProjs.push(res);
    }
    return res;
}
exports.buildProj = buildProj;
// Jest stuff
beforeEach(() => {
    activeProjs = [];
});
afterEach(() => {
    for (let activeProj of activeProjs) {
        activeProj.delete();
    }
    activeProjs = [];
});
